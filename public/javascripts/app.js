(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q;h=$("#board");M=$("#progress");Q=$("#board ul:gt(4) li");c=$("#board ul:lt(3) li");N=null;X=1;U=null;p=null;u=null;a=null;W=null;y="ABCDEFGHI";t=$("#cover");r=$("#guide");e=$("#chat");i=$("#msg");S=null;b=null;L=21;E=function(){var n;t.fadeIn();n=$("#name");$(n).submit($.proxy(function(t){t.preventDefault();N=$("#playerName").val();if(!N||N.length>16){N="Anonymous"}n.remove();m(N);C();socket.emit("player connect",{name:N});return e.fadeIn().submit($.proxy(function(e){var t,n;e.preventDefault();t=N;n=i.val();if(n!==""&&n.length<64){socket.emit("add message",{author:t,message:n})}return i.val("")}))}));n.show().appendTo(t);return $("#playerName").focus()};x=function(){e.hide();l();return E()};w=function(){H();d(b);r.hide();$("#pieces").show();return U="preparation"};C=function(){t.fadeIn();return M.show().appendTo(t)};H=function(){t.fadeOut();return M.hide()};V=function(){return $("#board ul li").off("click")};l=function(){return $(".piece").each(function(){var e,t;e=$(this);t=e.parent();return t.click(function(){var e,n,r,i,s,o,u,a,f,l,c;u=t.attr("id");if(U==="preparation"){if(u===void 0&&!t.hasClass("occupied")){return k(this)}}else if(U==="war"){i=u[1];r=u[0];l=r+(parseInt(i)+1);s=y[y.indexOf(r)-1]+i;a=y[y.indexOf(r)+1]+i;n=r+(parseInt(i)-1);c=e=o=f=false;if($("li#"+l).hasClass("occupied")||i==="8"){c=true}if($("li#"+n).hasClass("occupied")||i==="1"){e=true}if($("li#"+s).hasClass("occupied")||r==="A"){o=true}if($("li#"+a).hasClass("occupied")||r==="I"){f=true}if(c&&e&&o&&f){return console.log("can move this piece sorry")}else{return k(this)}}})})};J=function(){return $(".piece").parent().off("click")};s=$("#messages ul");f=function(e){return $("<li><span class='author'>"+e.author+"</span> : "+e.message+"</li>").prependTo(s)};n=$("#Dash");d=function(e){var t;if(e==="black"){t="#130f30"}else{t="#FFFFE5"}return n.css("background-color",t)};o=$("#turn");m=function(e){return o.html("General "+e)};j=function(e){var t,n,r,i,s,o,u,f,l,h;if(U==="preparation"){if(e==="black"){return c.addClass("legal").each(function(){var e;e=$(this);if(!e.hasClass("occupied")){return e.click(function(){return R(this)})}})}else if(e==="white"){return Q.addClass("legal").each(function(){var e;e=$(this);if(!e.hasClass("occupied")){return e.click(function(){return R(this)})}})}else{return console.log("unknown color")}}else if(U==="war"){u=a[1];o=a[0];if(u!=="8"){h=o+(parseInt(u)+1);i=$("li#"+h);if(!i.hasClass("occupied")){if(i.hasClass("opponent")){i.addClass("challenge")}else{i.addClass("legal")}i.click(function(){return R(this)})}}if(o!=="A"){f=y[y.indexOf(o)-1]+u;n=$("li#"+f);if(!n.hasClass("occupied")){if(n.hasClass("opponent")){n.addClass("challenge")}else{n.addClass("legal")}n.click(function(){return R(this)})}}if(o!=="I"){l=y[y.indexOf(o)+1]+u;r=$("li#"+l);if(!r.hasClass("occupied")){if(r.hasClass("opponent")){r.addClass("challenge")}else{r.addClass("legal")}r.click(function(){return R(this)})}}if(u!=="1"){s=o+(parseInt(u)-1);t=$("li#"+s);if(!t.hasClass("occupied")){if(t.hasClass("opponent")){t.addClass("challenge")}else{t.addClass("legal")}return t.click(function(){return R(this)})}}}};D=function(){return $("#board ul li").removeClass("legal challenge ")};_=function(){return $("#board ul li").removeClass("legal")};P=function(){return $("#board ul li").removeClass("lmove opponentMoved")};k=function(e){var t;t=$(e);u=e;if(U==="war"){a=t.attr("id")}t.addClass("active");V();J();return j(b)};R=function(e){var t,n,i,s,o,f,c,h;if(u){n=$(e);t=$(u);h=t.html();i=$(h);i.appendTo(n);o=n.attr("id");if(U==="preparation"){i.addClass("hint--right");s=i.attr("title");i.removeAttr("title").attr("data-hint",s);t.removeClass("active").fadeOut(100);--L;n.addClass("occupied").off("click");socket.emit("place piece",{cell:o,name:N});if(L===0){$("#pieces").hide();r.show();C();socket.emit("player ready",{name:N})}}else if(U==="war"){c=t.attr("id");f=$(t.find(".piece img")).attr("alt");t.removeClass("active occupied").children(".piece").remove();n.addClass("occupied");if(n.hasClass("challenge")){p=true}else{p=false}socket.emit("move piece",{crName:N,srcCell:c,destCell:o,piece:f,challenge:p})}D();l();u=null;return a=null}};A=function(e){return $("li#"+e.cell).addClass("opponent")};K=function(e){V();J();l();_();H();U="war";return g(e)};g=function(e){W=e.turn;m(e.name);d(W);if(W===b){return H()}else{return C()}};v=function(){if(W==="white"){W="black"}else if(W==="black"){W="white"}else{console.log("change_turn error")}return socket.emit("change turn",{turn:W})};T=function(e){P();$("li#"+e.destCell).addClass("opponentMoved opponent");return $("li#"+e.srcCell).addClass("lmove").removeClass("opponent")};z=function(e){var t;t=$("li#"+e.destCell).find(".piece img").attr("alt");return socket.emit("challenge end",{challengee:t,ceName:N,destCell:e.destCell,challenger:e.challenger,crName:e.crName,color:b})};B=function(e){var t;t=$("#"+e.destCell);if(e.tie){t.find('img[alt="'+e.winner+'"]').parent().remove();t.removeClass("opponent opponentMoved occupied")}else{if(t.find('img[alt="'+e.winner+'"]').length!==0){t.removeClass("opponent opponentMoved");O("points",false)}else{t.find('img[alt!="'+e.winner+'"]').parent().remove();t.removeClass("occupied")}}V();l();if(e.end){return I(e)}};I=function(e){var n,r,i;i=e.winnerName;if(N===e.winnerName){r="Well played, congratulations!";O("win",true)}else{r="You've been outplayed, sorry.";O("lose",true)}H();n="<div id='result'>\n    <img src='/images/GG_logo.png' alt='Game of the Generals Online' title='Game of the Generals Online' />\n    <hr />\n    <h1>General "+i+"<br/>has WON!</h1>\n    <hr />\n    <h2>"+r+"</h2>\n</div>";t.fadeIn();return $(n).appendTo(t)};F=function(){var e;e="<div id='result'>\n    <img src='/images/GG_logo.png' alt='Game of the Generals Online' title='Game of the Generals Online' />\n    <hr />\n    <h1>Sorry the Server is FULL!</h1>\n    <hr />\n    <h2>Please try again later.</h2>\n</div>";t.fadeIn();return $(e).appendTo(t)};q=new Audio;O=function(e,t){if(q.canPlayType("audio/mpeg")){q.src="audio/"+e+".mp3"}else if(q.canPlayType("audio/ogg")){q.src="audio/"+e+".ogg"}else{q.src=null}q.loop=t;if(q.src){q.load();return q.play()}};window.socket=io.connect();socket.on("initial connect",function(){O("title_sound",true);return x()});socket.on("player assign",function(e){console.log("socket.on player assign");S=e.id;return b=e.color});socket.on("game start",function(e){console.log("socket.on game start");O("",false);return w()});socket.on("war start",function(e){console.log("socket.on war start");W=e.turn;return K(e)});socket.on("change turn",function(e){console.log("socket.on change turn");return g(e)});socket.on("place piece",function(e){O("move",false);console.log("place piece");return A(e)});socket.on("move piece",function(e){console.log("move piece");O("move",false);T(e);if(!e.end){return v()}});socket.on("end game",function(e){console.log("end game");return I(e)});socket.on("challenge start",function(e){console.log("challenge start");return z(e)});socket.on("challenge complete",function(e){console.log("challenge end");O("challenge",false);return B(e)});socket.on("add message",function(e){console.log("add message");return f(e)});socket.on("full",function(){console.log("full");F();return socket.disconnect()})}).call(this)